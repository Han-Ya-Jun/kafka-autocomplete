# bash completion for Kafka                              -*- shell-script -*-

# Nice resources: wget, tarsnap

##
# Copyright 2017 Landoop, LTD
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

shopt -s extglob

_kafka-topics-configs()
{
    local cur prev configs
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    configs="cleanup.policy= \
             compression.type= \
             delete.retention.ms= \
             file.delete.delay.ms= \
             flush.messages= \
             flush.ms= \
             follower.replication.throttled= \
             index.interval.bytes= \
             leader.replication.throttled.replicas= \
             max.message.bytes= \
             message.format.version= \
             message.timestamp.difference.max.ms= \
             message.timestamp.type= \
             min.cleanable.dirty.ratio= \
             min.compaction.lag.ms= \
             min.insync.replicas= \
             preallocate= \
             retention.bytes= \
             retention.ms= \
             segment.bytes= \
             segment.index.bytes= \
             segment.jitter.ms= \
             segment.ms= \
             unclean.leader.election.enable="

    COMPREPLY=( $(compgen -W "${configs}" -- ${cur}) )
    compopt -o nospace
    return 0
}

_kafka-topics-delete-configs()
{
    local cur prev configs
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    configs="cleanup.policy \
             compression.type \
             delete.retention.ms \
             file.delete.delay.ms \
             flush.messages \
             flush.ms \
             follower.replication.throttled \
             index.interval.bytes \
             leader.replication.throttled.replicas \
             max.message.bytes \
             message.format.version \
             message.timestamp.difference.max.ms \
             message.timestamp.type \
             min.cleanable.dirty.ratio \
             min.compaction.lag.ms \
             min.insync.replicas \
             preallocate \
             retention.bytes \
             retention.ms \
             segment.bytes \
             segment.index.bytes \
             segment.jitter.ms \
             segment.ms \
             unclean.leader.election.enable"

    COMPREPLY=( $(compgen -W "${configs}" -- ${cur}) )
    return 0
}

_kafka-topics() {
    local cur prev opts wotherarg allopts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    wotherarg="--config --delete-config --partitions --replica-assignment \
               --replication-factor --topic --zookeeper"
    opts="--alter --create --delete --describe --disable-rack-aware --force \
          --help --if-not-exits --list --topics-with-overrides \
          --unavailable-partitions --under-replicated-partitions"


    allopts="$wotherarg $opts"

    case "$prev" in
	--config)
            _kafka-topics-configs
            return 0
            ;;
	--delete-config)
            _kafka-topics-delete-configs
            return 0
            ;;
    esac

    if [[ ${cur} == -* ]] ; then
        COMPREPLY=( $(compgen -W "${allopts}" -- ${cur}) )
        return 0
    fi
}

complete -F _kafka-topics kafka-topics
